<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LifeOS User Management Console</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg-primary:#0b1220;
  --bg-secondary:#121a2b;
  --bg-tertiary:#1e293b;
  --border:#2a354a;
  --text-primary:#e2e8f0;
  --text-secondary:#94a3b8;
  --accent:#6366f1;
  --success:#10b981;
  --error:#ef4444;
  --warning:#f59e0b;
  --info:#3b82f6;
}

body{
  font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg-primary);
  color:var(--text-primary);
  height:100vh;
  overflow:hidden;
}

/* Layout */
.app {
  display:grid;
  grid-template-columns:220px 1fr 420px;
  height:100vh;
}

@media(max-width:1200px){
  .app{ grid-template-columns:220px 1fr; }
  .terminal-panel{ display:none; }
}

/* Sidebar */
.sidebar{
  background:var(--bg-secondary);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  padding:16px 12px;
}

.sidebar h1{
  font-size:14px;
  font-weight:700;
  letter-spacing:.5px;
  margin-bottom:20px;
  color:var(--text-secondary);
}

.menu{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.menu a{
  text-decoration:none;
  color:var(--text-secondary);
  font-size:13px;
  padding:10px 12px;
  border-radius:8px;
  transition:.15s;
  border:1px solid transparent;
}

.menu a:hover{
  background:var(--bg-tertiary);
  color:var(--text-primary);
}

.menu a.active{
  background:var(--bg-tertiary);
  border:1px solid var(--accent);
  color:#fff;
}

/* Main Panel */
.main{
  display:flex;
  flex-direction:column;
  height:100%;
  overflow:hidden;
}

/* Top Bar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 16px;
  border-bottom:1px solid var(--border);
  background:var(--bg-secondary);
  font-size:13px;
}

.endpoint{
  font-family:monospace;
  color:var(--text-secondary);
}

.btn{
  border:none;
  background:var(--bg-tertiary);
  color:var(--text-primary);
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}

.btn:hover{ background:#334155; }

/* Content */
.content{
  padding:20px;
  overflow:auto;
  height:100%;
}

/* Cards */
.card{
  background:var(--bg-secondary);
  border:1px solid var(--border);
  border-radius:10px;
  margin-bottom:16px;
}

.card-header{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  font-weight:600;
  font-size:13px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.card-body{ padding:16px; }

input, textarea, select{
  width:100%;
  background:var(--bg-primary);
  border:1px solid var(--border);
  color:var(--text-primary);
  padding:10px;
  border-radius:8px;
  font-size:13px;
  font-family:monospace;
}

input:focus, textarea:focus, select:focus{
  outline:none;
  border-color:var(--accent);
}

.form-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.form-grid-3{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:12px;
}

button.action{
  margin-top:12px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  font-size:13px;
}

button.action-small{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
  font-size:12px;
}

.primary{ background:var(--accent); color:#fff; }
.success{ background:var(--success); color:#000; }
.warning{ background:var(--warning); color:#000; }
.danger{ background:var(--error); color:#fff; }
.info{ background:var(--info); color:#fff; }

/* Table Styles */
.data-table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}

.data-table th, .data-table td{
  padding:10px;
  text-align:left;
  border-bottom:1px solid var(--border);
}

.data-table th{
  color:var(--text-secondary);
  font-weight:600;
  background:var(--bg-primary);
}

.data-table tr:hover{
  background:var(--bg-tertiary);
}

.badge{
  display:inline-block;
  padding:2px 8px;
  border-radius:4px;
  font-size:11px;
  font-weight:600;
}

.badge-success{ background:var(--success); color:#000; }
.badge-error{ background:var(--error); color:#fff; }
.badge-warning{ background:var(--warning); color:#000; }
.badge-info{ background:var(--info); color:#fff; }

/* Response Box */
.response-box{
  margin-top:12px;
  padding:12px;
  background:var(--bg-primary);
  border:1px solid var(--border);
  border-radius:8px;
  display:none;
}

.response-box pre{
  font-family:monospace;
  font-size:12px;
  overflow:auto;
  max-height:300px;
}

/* Terminal unchanged */
.terminal-panel{
  background:#000;
  border-left:1px solid var(--border);
  display:flex;
  flex-direction:column;
}

.terminal-header{
  display:flex;
  justify-content:space-between;
  padding:14px 18px;
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border);
  font-size:13px;
}

.terminal-body{
  flex:1;
  overflow:auto;
  padding:16px;
  font-family:monospace;
  font-size:12px;
  line-height:1.6;
}

.log-entry{ margin-bottom:10px; }
.log-info{ color:#60a5fa; }
.log-success{ color:#10b981; }
.log-error{ color:#ef4444; }
.log-warning{ color:#f59e0b; }

/* Pagination */
.pagination{
  display:flex;
  gap:8px;
  margin-top:12px;
  justify-content:center;
}

.pagination button{
  padding:6px 12px;
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  color:var(--text-primary);
  border-radius:6px;
  cursor:pointer;
}

.pagination button:hover{
  background:var(--accent);
}

.pagination button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

/* Tabs */
.tabs{
  display:flex;
  gap:8px;
  margin-bottom:16px;
  border-bottom:1px solid var(--border);
  padding-bottom:8px;
}

.tab-btn{
  padding:8px 16px;
  background:transparent;
  border:1px solid transparent;
  color:var(--text-secondary);
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
}

.tab-btn:hover{
  background:var(--bg-tertiary);
  color:var(--text-primary);
}

.tab-btn.active{
  background:var(--bg-tertiary);
  border-color:var(--accent);
  color:#fff;
}

.tab-content{
  display:none;
}

.tab-content.active{
  display:block;
}
</style>
</head>

<body>
<div class="app">

<!-- Sidebar -->
<div class="sidebar">
  <h1>DEV TEST MENU</h1>
  <div class="menu">
    <a href="index.html">Auth Tests</a>
    <a href="#" class="active">User Tests</a>
  </div>
</div>

<!-- Main Panel -->
<div class="main">
  <div class="topbar">
    <div class="endpoint" id="api-endpoint">http://localhost:3000/api/v1</div>
    <div>
      <button class="btn" onclick="setEndpoint('http://localhost:3000/api/v1')">Local</button>
      <button class="btn" onclick="setEndpoint('http://localhost:3001/api/v1')">Docker</button>
    </div>
  </div>

  <div class="content">

    <!-- AUTH TOKEN -->
    <div class="card">
      <div class="card-header">
        <span>Authentication Token</span>
        <span class="badge badge-info">Required</span>
      </div>
      <div class="card-body">
        <textarea id="auth-token" rows="2" placeholder="Paste admin access token here"></textarea>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;">
          <button class="action info" onclick="loadTokenFromStorage()">Load from Storage</button>
          <button class="action warning" onclick="testToken()">Test Token</button>
        </div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('list', this)">List Users</button>
      <button class="tab-btn" onclick="switchTab('create', this)">Create User</button>
      <button class="tab-btn" onclick="switchTab('manage', this)">Manage User</button>
      <button class="tab-btn" onclick="switchTab('profile', this)">My Profile</button>
      <button class="tab-btn" onclick="switchTab('stats', this)">Statistics</button>
    </div>

    <!-- TAB: LIST USERS -->
    <div id="tab-list" class="tab-content active">
      <div class="card">
        <div class="card-header">Search & Filter</div>
        <div class="card-body">
          <div class="form-grid-3">
            <input id="filter-search" placeholder="Search email/name" />
            <select id="filter-active">
              <option value="">All Status</option>
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
            <select id="filter-verified">
              <option value="">All Verification</option>
              <option value="true">Verified</option>
              <option value="false">Unverified</option>
            </select>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:12px;">
            <input id="filter-page" type="number" value="1" min="1" placeholder="Page" />
            <input id="filter-limit" type="number" value="10" min="1" max="100" placeholder="Limit" />
            <button class="action primary" onclick="listUsers()">Search Users</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Users List</div>
        <div class="card-body">
          <div id="users-table-container">
            <p style="color:var(--text-secondary);text-align:center;padding:20px;">Click "Search Users" to load data</p>
          </div>
          <div class="pagination" id="pagination-controls" style="display:none;">
            <button onclick="changePage(-1)">‚Üê Prev</button>
            <span id="page-info" style="padding:6px 12px;">Page 1</span>
            <button onclick="changePage(1)">Next ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: CREATE USER -->
    <div id="tab-create" class="tab-content">
      <div class="card">
        <div class="card-header">Create New User</div>
        <div class="card-body">
          <div class="form-grid">
            <input id="create-email" placeholder="Email" />
            <input id="create-password" placeholder="Password" type="password" />
            <input id="create-firstname" placeholder="First Name" />
            <input id="create-lastname" placeholder="Last Name" />
          </div>
          <div style="margin-top:12px;">
            <label style="display:flex;align-items:center;gap:8px;color:var(--text-secondary);font-size:13px;">
              <input type="checkbox" id="create-active" checked style="width:auto;" />
              Active
            </label>
          </div>
          <button class="action success" onclick="createUser()">Create User</button>
          
          <div id="create-response" class="response-box">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
              <span id="create-status" class="badge"></span>
            </div>
            <pre id="create-result"></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: MANAGE USER -->
    <div id="tab-manage" class="tab-content">
      <div class="card">
        <div class="card-header">Find User</div>
        <div class="card-body">
          <div class="form-grid">
            <input id="manage-user-id" placeholder="User ID (UUID)" />
            <button class="action primary" onclick="getUser()">Get User</button>
          </div>
        </div>
      </div>

      <div class="card" id="user-details-card" style="display:none;">
        <div class="card-header">User Details</div>
        <div class="card-body">
          <div class="form-grid">
            <input id="update-email" placeholder="Email" />
            <input id="update-firstname" placeholder="First Name" />
            <input id="update-lastname" placeholder="Last Name" />
            <select id="update-active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px;">
            <button class="action warning" onclick="updateUser()">Update User</button>
            <button class="action danger" onclick="deleteUser()">Delete User</button>
          </div>
          
          <div id="manage-response" class="response-box">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
              <span id="manage-status" class="badge"></span>
            </div>
            <pre id="manage-result"></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: MY PROFILE -->
    <div id="tab-profile" class="tab-content">
      <div class="card">
        <div class="card-header">My Profile</div>
        <div class="card-body">
          <button class="action primary" onclick="getMyProfile()">Load Profile</button>
          
          <div id="profile-display" style="margin-top:16px;display:none;">
            <div class="form-grid">
              <input id="my-firstname" placeholder="First Name" />
              <input id="my-lastname" placeholder="Last Name" />
              <input id="my-email" placeholder="Email" />
            </div>
            <button class="action success" onclick="updateMyProfile()" style="margin-top:12px;">Update Profile</button>
          </div>

          <div id="profile-response" class="response-box">
            <pre id="profile-result"></pre>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Change Password</div>
        <div class="card-body">
          <div class="form-grid">
            <input id="current-password" type="password" placeholder="Current Password" />
            <input id="new-password" type="password" placeholder="New Password" />
          </div>
          <button class="action warning" onclick="changePassword()">Change Password</button>
          
          <div id="password-response" class="response-box">
            <pre id="password-result"></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: STATISTICS -->
    <div id="tab-stats" class="tab-content">
      <div class="card">
        <div class="card-header">User Statistics</div>
        <div class="card-body">
          <button class="action primary" onclick="getStats()">Load Statistics</button>
          
          <div id="stats-display" style="margin-top:16px;display:none;">
            <div class="form-grid-3">
              <div style="text-align:center;padding:20px;background:var(--bg-primary);border-radius:8px;">
                <div style="font-size:24px;font-weight:bold;color:var(--accent);" id="stat-total">0</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">Total Users</div>
              </div>
              <div style="text-align:center;padding:20px;background:var(--bg-primary);border-radius:8px;">
                <div style="font-size:24px;font-weight:bold;color:var(--success);" id="stat-active">0</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">Active</div>
              </div>
              <div style="text-align:center;padding:20px;background:var(--bg-primary);border-radius:8px;">
                <div style="font-size:24px;font-weight:bold;color:var(--error);" id="stat-inactive">0</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">Inactive</div>
              </div>
              <div style="text-align:center;padding:20px;background:var(--bg-primary);border-radius:8px;">
                <div style="font-size:24px;font-weight:bold;color:var(--info);" id="stat-verified">0</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">Verified</div>
              </div>
              <div style="text-align:center;padding:20px;background:var(--bg-primary);border-radius:8px;">
                <div style="font-size:24px;font-weight:bold;color:var(--warning);" id="stat-unverified">0</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">Unverified</div>
              </div>
            </div>
          </div>

          <div id="stats-response" class="response-box">
            <pre id="stats-result"></pre>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Terminal (UNCHANGED HOOK) -->
<div class="terminal-panel">
  <div class="terminal-header">
    <span>API Activity Log</span>
    <div>
      <button class="btn" onclick="copyLogs()">Copy</button>
      <button class="btn" onclick="clearLogs()">Clear</button>
    </div>
  </div>
  <div class="terminal-body" id="logger">
    <div class="log-entry log-info">[SYSTEM] User Management Console initialized...</div>
  </div>
</div>

</div>

<script>
// Global variables
window.API_BASE = localStorage.getItem('api-endpoint') || 'http://localhost:3000/api/v1';
window.accessToken = localStorage.getItem('access-token') || '';
window.currentPage = 1;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('api-endpoint').textContent = window.API_BASE;
    if (window.accessToken) {
        document.getElementById('auth-token').value = window.accessToken;
    }
});

// Logger Functions
function log(message, type, details) {
    type = type || 'info';
    var logger = document.getElementById('logger');
    var timestamp = new Date().toLocaleTimeString();
    
    var entry = document.createElement('div');
    entry.className = 'log-entry log-' + type;
    
    var html = '<span class="log-timestamp">[' + timestamp + ']</span> ' + message;
    
    if (details) {
        html += '<div style="margin-top:4px;padding-left:20px;color:var(--text-secondary);">' + details + '</div>';
    }
    
    entry.innerHTML = html;
    logger.appendChild(entry);
    logger.scrollTop = logger.scrollHeight;
}

function clearLogs() {
    document.getElementById('logger').innerHTML = '<div class="log-entry log-info"><span class="log-timestamp">[SYSTEM]</span> Logger cleared.</div>';
}

function copyLogs() {
    var logger = document.getElementById('logger');
    var text = logger.innerText;
    navigator.clipboard.writeText(text);
    log('Logs copied to clipboard', 'success');
}

// API Call
function apiCall(endpoint, options) {
    options = options || {};
    var url = window.API_BASE + endpoint;
    var method = options.method || 'GET';
    
    var token = document.getElementById('auth-token').value;
    if (!token) {
        log('‚ùå No auth token provided', 'error');
        return Promise.reject('No token');
    }
    
    var headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
    };
    
    var requestDetails = method + ' ' + endpoint;
    if (options.body) {
        requestDetails += '\nBody: ' + options.body.substring(0, 200);
    }
    
    log('‚Üí ' + method + ' ' + endpoint, 'info', requestDetails);

    return fetch(url, {
        method: method,
        headers: headers,
        body: options.body
    }).then(function(response) {
        return response.json().then(function(data) {
            var statusType = response.ok ? 'success' : 'error';
            var responseStr = JSON.stringify(data, null, 2).substring(0, 500);
            log('‚Üê ' + response.status + ' ' + (response.ok ? 'OK' : 'ERROR'), statusType, responseStr);
            
            return { 
                success: response.ok, 
                data: data, 
                status: response.status 
            };
        });
    }).catch(function(error) {
        log('‚Üê Network Error: ' + error.message, 'error');
        return { success: false, error: error.message };
    });
}

// Tab Switching
function switchTab(tabName, element) {
    document.querySelectorAll('.tab-btn').forEach(function(t) { t.classList.remove('active'); });
    document.querySelectorAll('.tab-content').forEach(function(t) { t.classList.remove('active'); });
    
    if (element) element.classList.add('active');
    document.getElementById('tab-' + tabName).classList.add('active');
}

// Token Management
function loadTokenFromStorage() {
    var token = localStorage.getItem('access-token');
    if (token) {
        document.getElementById('auth-token').value = token;
        log('‚úÖ Token loaded from localStorage', 'success');
    } else {
        log('‚ùå No token found in localStorage', 'error');
    }
}

function testToken() {
    apiCall('/users/me/profile').then(function(result) {
        if (result.success) {
            log('‚úÖ Token is valid', 'success');
        } else {
            log('‚ùå Token is invalid or expired', 'error');
        }
    });
}

// USER MANAGEMENT FUNCTIONS

function listUsers() {
    var search = document.getElementById('filter-search').value;
    var isActive = document.getElementById('filter-active').value;
    var emailVerified = document.getElementById('filter-verified').value;
    var page = document.getElementById('filter-page').value;
    var limit = document.getElementById('filter-limit').value;
    
    var queryParams = new URLSearchParams();
    if (search) queryParams.append('search', search);
    if (isActive) queryParams.append('isActive', isActive);
    if (emailVerified) queryParams.append('emailVerified', emailVerified);
    queryParams.append('page', page);
    queryParams.append('limit', limit);
    
    apiCall('/users?' + queryParams.toString()).then(function(result) {
        if (result.success) {
            renderUsersTable(result.data);
            document.getElementById('pagination-controls').style.display = 'flex';
            document.getElementById('page-info').textContent = 'Page ' + page;
            window.currentPage = parseInt(page);
        }
    });
}

function renderUsersTable(data) {
    var container = document.getElementById('users-table-container');
    var users = data.data || [];
    
    if (users.length === 0) {
        container.innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:20px;">No users found</p>';
        return;
    }
    
    var html = '<table class="data-table"><thead><tr>' +
        '<th>ID</th>' +
        '<th>Email</th>' +
        '<th>Name</th>' +
        '<th>Status</th>' +
        '<th>Verified</th>' +
        '<th>Actions</th>' +
        '</tr></thead><tbody>';
    
    users.forEach(function(user) {
        var statusBadge = user.isActive ? 
            '<span class="badge badge-success">Active</span>' : 
            '<span class="badge badge-error">Inactive</span>';
        var verifiedBadge = user.emailVerified ? 
            '<span class="badge badge-success">Yes</span>' : 
            '<span class="badge badge-warning">No</span>';
        
        html += '<tr>' +
            '<td>' + user.id.substring(0, 8) + '...</td>' +
            '<td>' + user.email + '</td>' +
            '<td>' + (user.fullName || user.firstName + ' ' + user.lastName) + '</td>' +
            '<td>' + statusBadge + '</td>' +
            '<td>' + verifiedBadge + '</td>' +
            '<td><button class="action-small info" onclick="selectUser(\'' + user.id + '\')">Edit</button></td>' +
            '</tr>';
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}

function changePage(delta) {
    var pageInput = document.getElementById('filter-page');
    var newPage = parseInt(pageInput.value) + delta;
    if (newPage < 1) return;
    pageInput.value = newPage;
    listUsers();
}

function selectUser(userId) {
    document.getElementById('manage-user-id').value = userId;
    switchTab('manage', document.querySelectorAll('.tab-btn')[2]);
    getUser();
}

function createUser() {
    var payload = {
        email: document.getElementById('create-email').value,
        password: document.getElementById('create-password').value,
        firstName: document.getElementById('create-firstname').value,
        lastName: document.getElementById('create-lastname').value,
        isActive: document.getElementById('create-active').checked
    };
    
    apiCall('/users', {
        method: 'POST',
        body: JSON.stringify(payload)
    }).then(function(result) {
        var responseDiv = document.getElementById('create-response');
        var resultPre = document.getElementById('create-result');
        var statusBadge = document.getElementById('create-status');
        
        responseDiv.style.display = 'block';
        resultPre.textContent = JSON.stringify(result.data, null, 2);
        statusBadge.textContent = result.status + (result.success ? ' Created' : ' Error');
        statusBadge.className = 'badge ' + (result.success ? 'badge-success' : 'badge-error');
        
        if (result.success) {
            log('‚úÖ User created successfully', 'success');
        }
    });
}

function getUser() {
    var userId = document.getElementById('manage-user-id').value;
    if (!userId) {
        log('‚ùå Please enter user ID', 'error');
        return;
    }
    
    apiCall('/users/' + userId).then(function(result) {
        if (result.success) {
            var user = result.data;
            document.getElementById('update-email').value = user.email;
            document.getElementById('update-firstname').value = user.firstName;
            document.getElementById('update-lastname').value = user.lastName;
            document.getElementById('update-active').value = user.isActive.toString();
            document.getElementById('user-details-card').style.display = 'block';
        }
    });
}

function updateUser() {
    var userId = document.getElementById('manage-user-id').value;
    var payload = {
        email: document.getElementById('update-email').value,
        firstName: document.getElementById('update-firstname').value,
        lastName: document.getElementById('update-lastname').value,
        isActive: document.getElementById('update-active').value === 'true'
    };
    
    apiCall('/users/' + userId, {
        method: 'PUT',
        body: JSON.stringify(payload)
    }).then(function(result) {
        showManageResponse(result, 'Updated');
    });
}

function deleteUser() {
    var userId = document.getElementById('manage-user-id').value;
    if (!confirm('Are you sure you want to delete this user?')) return;
    
    apiCall('/users/' + userId, {
        method: 'DELETE'
    }).then(function(result) {
        showManageResponse(result, 'Deleted');
        if (result.success) {
            document.getElementById('user-details-card').style.display = 'none';
        }
    });
}

function showManageResponse(result, action) {
    var responseDiv = document.getElementById('manage-response');
    var resultPre = document.getElementById('manage-result');
    var statusBadge = document.getElementById('manage-status');
    
    responseDiv.style.display = 'block';
    resultPre.textContent = JSON.stringify(result.data, null, 2);
    statusBadge.textContent = result.status + (result.success ? ' ' + action : ' Error');
    statusBadge.className = 'badge ' + (result.success ? 'badge-success' : 'badge-error');
}

// PROFILE FUNCTIONS

function getMyProfile() {
    apiCall('/users/me/profile').then(function(result) {
        var display = document.getElementById('profile-display');
        var responseDiv = document.getElementById('profile-response');
        var resultPre = document.getElementById('profile-result');
        
        if (result.success) {
            var user = result.data;
            document.getElementById('my-firstname').value = user.firstName;
            document.getElementById('my-lastname').value = user.lastName;
            document.getElementById('my-email').value = user.email;
            display.style.display = 'block';
        }
        
        responseDiv.style.display = 'block';
        resultPre.textContent = JSON.stringify(result.data, null, 2);
    });
}

function updateMyProfile() {
    var payload = {
        firstName: document.getElementById('my-firstname').value,
        lastName: document.getElementById('my-lastname').value,
        email: document.getElementById('my-email').value
    };
    
    apiCall('/users/me/profile', {
        method: 'PUT',
        body: JSON.stringify(payload)
    }).then(function(result) {
        var responseDiv = document.getElementById('profile-response');
        var resultPre = document.getElementById('profile-result');
        responseDiv.style.display = 'block';
        resultPre.textContent = JSON.stringify(result.data, null, 2);
        
        if (result.success) {
            log('‚úÖ Profile updated', 'success');
        }
    });
}

function changePassword() {
    var payload = {
        currentPassword: document.getElementById('current-password').value,
        newPassword: document.getElementById('new-password').value
    };
    
    apiCall('/users/me/change-password', {
        method: 'POST',
        body: JSON.stringify(payload)
    }).then(function(result) {
        var responseDiv = document.getElementById('password-response');
        var resultPre = document.getElementById('password-result');
        responseDiv.style.display = 'block';
        resultPre.textContent = result.success ? 'Password changed successfully' : JSON.stringify(result.data, null, 2);
        
        if (result.success) {
            log('‚úÖ Password changed', 'success');
        }
    });
}

// STATISTICS

function getStats() {
    apiCall('/users/stats').then(function(result) {
        if (result.success) {
            var stats = result.data;
            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-active').textContent = stats.active;
            document.getElementById('stat-inactive').textContent = stats.inactive;
            document.getElementById('stat-verified').textContent = stats.verified;
            document.getElementById('stat-unverified').textContent = stats.unverified;
            document.getElementById('stats-display').style.display = 'block';
        }
        
        var responseDiv = document.getElementById('stats-response');
        var resultPre = document.getElementById('stats-result');
        responseDiv.style.display = 'block';
        resultPre.textContent = JSON.stringify(result.data, null, 2);
    });
}

// Utilities
function setEndpoint(endpoint) {
    window.API_BASE = endpoint;
    localStorage.setItem('api-endpoint', endpoint);
    document.getElementById('api-endpoint').textContent = endpoint;
    log('üåê API endpoint changed to: ' + endpoint, 'info');
}
</script>
</body>
</html>